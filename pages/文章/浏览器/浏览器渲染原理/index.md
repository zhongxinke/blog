# 浏览器解析并渲染原理

<img src="http://zhongxk.com/blogImg/浏览器解析并渲染流程.png" title="渲染流程图" alt="渲染流程图" width="802px" style="max-width: none" />

## 1.解析HTML

浏览器将服务器返回的数据解析成上面的DOM结构，开始逐行解析。

## 2.解析CSSOM

解析到<link />标签，下载css文件，解析CSS文件构建CSSOM，继续解析DOM

## 3.\<script\> 标签

遇到\<script\>标签，下载JS文件，执行JS，这时会阻塞解析DOM和CSSOM

## 4.结合渲染树

完成构建DOM树和CSSOM树后，两者结合成渲染树，不需要显示的元素如设置**display:none**的元素和\<head\>等标签不会在渲染树。

## 5.计算元素几何信息

首次渲染之前，需要计算元素的大小、位置等信息，为了确定每个元素的大小和位置，浏览器会从渲染树的根节点开始遍历。
第一次确定节点大小和位置称为布局，随后对节点大小和位置重新计算称为重排

## 6.绘制

在绘制或光栅化阶段，浏览器将在布局阶段计算每个盒子转换为屏幕的实际像素
为了确保重绘能够比初始绘制更快地完成，会知道屏幕的操作被分解成几个图层
分层确实可以提高效率，但是同时也牺牲了内存

## 7.合成

## 总结

通过上面的流程，我们可以从不同阶段进行优化

1. 减少重排重绘

- 动画尽量使用transforom
- canvas离屏
- \<img /\>标签固定宽高
- 避免使用\<table \>，因为 table 会等到它的 dom 树全部生成后再一次性插入页面中，而导致重排
- 使用防抖

2. 优化渲染

- \<script \>标签放在body后面，尽量不要写内联逻辑，防止阻塞DOM解析
- 按需加载、预加载、懒加载
- css雪碧图
- 骨架屏
