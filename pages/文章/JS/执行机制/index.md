# Javascript的执行机制

> [这一次，彻底弄懂 JavaScript 执行机制](https://juejin.cn/post/6844903512845860872)

## 单线程

Javascript是单线程的，这意味着它一次只能执行一个任务，通过调用栈负责管理函数调用和返回：

- 当一个函数被调用时，它会被推入调用栈的顶部
- 当函数执行完毕后，它会从调用栈中弹出

所以当有一个任务执行的时间很长，其他任务都要等待，就会出现卡顿或者页面空白。

## 同步和异步任务

将任务分为：

- 同步
- 异步

同步任务进入主线程，将异步任务保存到任务队列。当调用栈为空时，查看任务队列是否有任务

## 任务队列

任务队列里的任务还可以再细分：

- 宏任务：setTimeout、setInterval、I/O操作等
- 微任务：Promise.then、MutationObserver、process.nextTick

**微任务的优先级高于宏任务**

## 总结

在执行调用栈中的任务时，当调用栈为空后，JavaScript 引擎会检查任务队列是否有任务。如果有任务，事件循环会优先执行微任务队列中的任务，再执行宏任务队列中的任务。JavaScript 引擎的监控进程（monitoring process）会不断重复这个检查和执行的过程，这个过程就称为事件循环。

**用一个例子来验证**

```js
for (var i = 0; i < 10; i++) {
  setTimeout(() => {
    console.log(i);
  }, 0);
}
```

这个例子的结果是打印了10次10。我们用事件循环机制来解释这个问题。

这里的for循环进入主线程，每执行一次循环，都有 i++ 和 setTimeout。

所以每次循环，都有一个setTimeout进入任务队列，当循环结束之后，调用栈为空，任务队列里有10个宏任务

然后执行任务队列的所有任务，此时i为10，执行console.log(i)，结果就是打印了10次10
