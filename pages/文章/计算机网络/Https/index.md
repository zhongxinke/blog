# HTTPS

## 对称加密

<img src="http://zhongxk.com/blogImg/对称加密.png" title="对称加密" alt="对称加密">

1. 客户端首先发送hello请求，并将可支持的tls版本和加密算法列表发送给服务器。
2. 服务器收到hello请求后，选择一个可支持的tls版本和加密算法，并将信息发送给客户端。
3. 客户端收到服务器的信息后，生成一个随机字符串，并使用加密函数和算法对随机字符串进行加密，此时生成了会话密钥，然后将随机字符串发送给服务器。
4. 服务端接收到随机字符串后，使用同样的加密函数和算法进行加密，生成与客服端一致的会话密钥
5. 客户端和服务端都使用会话密钥进行加密解密通信。

## 非对称加密

<img src="http://zhongxk.com/blogImg/非对称加密.png" title="非对称加密" alt="非对称加密">

1. 客户端首先发送hello请求，并将可支持的tls版本和加密算法列表发送给服务器。、
2. 服务器收到hello请求后，选择一个可支持的tls版本和加密算法，并将信息发送给客户端，此外还会将公钥发送给客户端。
3. 客户端收到服务器的信息后，生成一个随机字符串，并使用接收到的公钥进行加密，再将其传递给服务端。
4. 服务器端接收到加密后的预主密钥后，使用自己的私钥进行解密，得到与客户端一致的预主密钥。
5. 客户端和服务端都使用预主密钥进行加密解密通信。

## 完整过程（TLS握手）

1. 首先客服端发送请求，并通过TCP/IP协议与服务端建立连接。
2. 客户端发送hello请求，并选择可支持的tls版本和加密算法。
3. 服务器收到hello请求后，选择一个可支持的tls版本和加密算法，并将信息发送给客户端，此外还会发送证书发送给客户端。
4. 客户端收到证书后，验证证书的合法性，验证成功后，从证书中提取出服务器端的公钥。
5. 客户端生成预主密钥，并使用服务器端的公钥进行加密，将加密后的预主密钥发送给服务端。
6. 服务端接收到加密后的预主密钥后，使用自己的私钥进行解密，得到与客户端一致的预主密钥。
7. 客户端和服务端都使用预主密钥进行加密解密通信。